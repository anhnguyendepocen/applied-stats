knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse) # the old fave
library(survival) # useful stuff for survival analysis
library(eha) # has the dataset
data(fert)
f12 <- fert %>% as_tibble() %>% filter(parity ==1)
head(f12)
f12 <- f12 %>%
mutate(age_group = ifelse(age<30, "<30", "30+"))
survobject <- Surv(time = f12$next.ivl, event = f12$event)
head(survobject)
fit <- survfit(Surv(next.ivl, event) ~ 1, data = f12)
fit_df <- tibble(time = fit$time, surv = fit$surv)
ggplot(aes(time, surv), data = fit_df) +
geom_line() +
ggtitle("Proportion of women who \nhave not had their second birth by time (years)") +
xlab("years") + ylab("S(t)")+
theme_bw(base_size = 14)
n <- nrow(f12)
f12 <- f12 %>%
arrange(XX) %>% # need to sort by survival times
mutate(cumulative_people_lost = 1:n(),
exposure = lag(n - cumulative_people_lost, default = n),
prob_death = XX,
prob_surv = XX,
surv = cumprod(XX))
cutpoints <- c(10/12, 1.25, 1.75, 2.25, seq(3,5), seq(6, 12, by = 3))
C <- length(cutpoints) + 1
f12_split <- survSplit(formula = Surv(time = next.ivl, event = event) ~ .,
data = f12, cut = cutpoints) %>%
as_tibble() %>%
mutate(interval = factor(tstart),
interval_length = next.ivl - tstart)
f12_split
View(f12)
View(f12_split)
